(($# < 1 )) && echo2 "${C}${FUNCNAME}${c} [/var/log/messages]${END}" && exit 99

if [ -n "$1" ]; then
  messages=$1
else
  [ -n /var/log/messages ] && messages=/var/log/messages
  [ -n /var/log/syslog ] && messages=/var/log/syslog
fi

if [ "${messages%nginx*}" != "${messages}" ]; then
  # this is an nginx log, we are looking for pattern=client: 2602:47:df68:8900:34b9:f357:26bf:8122,
  # TODO: also include the url GET the script kiddy is trying
  # 2021/12/29 07:38:59 [error] 632#632: *42829 FastCGI sent in stderr: "Primary script unknown" while reading response header from upstream, client: 45.90.61.53, server: _, request: "GET /3ds.php HTTP/2.0", upstream: "fastcgi://127.0.0.1:9000", host: "pictures.domain.com"

  grep -shoP '(?<=client: )[^,]*' $messages | sort | uniq >/tmp/listHackers.log
else
  # this is a system log
  awk '/password/ {print $NF}' $messages | cut -f1 -d: | sort | uniq >/tmp/listHackers.log
fi

wc /tmp/listHackers.log
# now analyze each IP address:
wwhois /tmp/listHackers.log

